# 2026-02-02 — Major Payment Portal & Deployment Fixes

## Payment Portal Fixes (Hope Brown)
- **Token:** CRG2DRPRPS34ZCCJ for Hope Brown (hopebrownmalibu@gmail.com, 310-924-1372)
- **Quote ID:** a7e45a61-5a38-4dbf-862d-8e359ff9b6e0
- **Project ID:** 33895b4b-d38a-42e1-a924-9cf83396af62
- **Project Total:** $1,953.48
- **Paid (50% deposit):** $976.74
- **Balance Due:** $976.74

### Issues Fixed:
1. Payment links were using Lovable preview domain instead of production — hardcoded `https://818shuttersandshades.com` in `generate-payment-portal-access`
2. Token validation failing due to joins — simplified `validate-payment-portal-token` to query without problematic joins
3. Payment summary not showing payments — updated `get-customer-payment-summary` to check both `quote_builder_quotes` AND `projects` tables, and match payments via both `quote_id` and `quote_builder_quote_id`
4. `$NaN` for deposits pending — fixed calculation, added `suggested_payment` field for auto-populating payment amount
5. Disabled RLS on `payment_portal_access` table (edge functions use service role)

## Supabase CLI Setup
- Logged in with token: `sbp_8bdfe81f3ba46a9707e815aa34498475eafffec6`
- Linked project: `xydwuivujuutoigmqeaj`
- Fixed `supabase/config.toml` by commenting out deprecated keys (port, schedule, edge-runtime)
- Can now deploy edge functions directly via CLI

## Vercel Deployment
- Deployed to Vercel (bypassing Lovable credits)
- Token: `QE1mENjWI58oeyL2meJbmHBF`
- Account: `aricweinberg-7034`
- Domains configured:
  - 818shuttersandshades.com
  - app.818shuttersandshades.com
  - pay.818shuttersandshades.com
- All pointing to `eighty-one-eight-shades` project

## Quote Builder Persistence Fixes
- Added `isDirty: true` to all state-mutating actions in `quoteBuilderStore.ts`
- Nav-intercept with save in `QuoteBuilderVerticalNav.tsx`
- Unmount flush save in `RoomBuilder.tsx` and `DesignPage.tsx`
- `beforeunload` warning for unsaved changes
- Reduced auto-save debounce from 2000ms to 800ms

## UI Fixes
- Venmo QR code replaced with clean scannable version (`payment-venmo-qr-clean.png`)
- QR codes enlarged from 128px to 192px
- Contact info corrected: (818) 665-7244, hello@818shuttersandshades.com
- Removed manufacturer names from comparison table ("Premium custom brands" instead of "Norman, Hunter Douglas")

## Infrastructure Discussion
- User interested in moving off Willie's Mac mini
- Discussed: Railway, N8N, Cloudflare moltworker
- Recommendation: VPS (DigitalOcean/Railway) is easiest migration path for Clawdbot
- Moltworker would require rebuild, not migration
